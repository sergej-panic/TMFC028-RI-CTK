#################################################################
########### Running ctk on TMFC028-RI and TMFC035-RI ############
#################################################################

Note:
- tested and working on Canvas version 1.2.4-AK1, Kubernetes core APIs: v1.34.1), windows OS
- "cmd>" represents a command line
- "<projectFolder>"" refers to the folder where the curent README file resides


############# First: Deploy the TMFC028 and TMFC035 components to the ODA canvas. #############

We need to deploy TMFC028 Party compoment.
And also TMFC035 Permission component which is implemented as a stub. It exposes the TMF669 PartyRole API core function for the
TMFC028 Party component, which depends on this API. This stub is used when running the TMFC028 CTK BDD tests.
It allows the TMFC028 Party component to interact with the PartyRole API and verify that a partyRole instance referenced
in "party.engagedParty[0]" actually exists in the TMFC035 PartyRole service.


1.) Open CMD terminal and navigate to the TMFC028 Party ComponentRI folder.

    cmd> cd <projectFolder>\TMFC028-PartyManagement\CTK\ComponentRI

2.) Install the Party component onto the oda-canvas. Let's use "par" as the release name.

    cmd> helm install par . -n components

3.) The par-party component will not fully deploy, but get stuck in "In-Progress-CompCon" status.
    It is waiting for the dependendent partyRole api from the TMFC025 component to become available.

    cmd> kubectl get components -n components

    NAME        DEPLOYMENT_STATUS
    par-party   In-Progress-CompCon

4.) The par-party component exposed apis are in "ready" state.

    cmd> kubectl get exposedapis -n components

    NAME                             API_ENDPOINT                                   IMPLEMENTATION_READY
    par-party-party-management-api   https://localhost/par-party/tmf-api/party/v4   true

5.) The par-party component dependent apis are NOT in "ready" status.
    The par-party component does not have its dependent api in the READY=true state.
    It is waiting for the dependendent partyRole api from the TMFC035 Persmission component to become ready.

    cmd> kubectl get dependentapis -n components

    NAME                                  READY   AGE   SVCINVID   URL
    par-party-party-role-management-api           25s


6.) Navigate to the TMFC035 Permission ComponentRI folder.

    cmd> cd <projectFolder>\TMFC035-PermissionsManagement-stub\CTK\ComponentRI

7.) Install the Permission component onto the oda-canvas. Let's use "per" as the release name.

    cmd> helm install per . -n components

8.) The per-permission component will fully deploy, with status "Complete".
    It is waiting for the dependendent party api from the TMFC028 component to become ready.
    The per-party still remains in status "In-Progress-DepApi"

    cmd> kubectl get components -n components

    NAME             DEPLOYMENT_STATUS
    par-party        In-Progress-DepApi
    per-permission   Complete


9.) The per-permission component exposed apis are in "ready" status.

    cmd> kubectl get exposedapis -n components

    NAME                                                API_ENDPOINT                                                      IMPLEMENTATION_READY
    par-party-party-management-api                      https://localhost/par-party/tmf-api/party/v4                      true
    per-permission-party-role-management-api            https://localhost/per-permission/tmf-api/partyRoleManagement/v4   true
    per-permission-userrole-permission-management-api   https://localhost/per-permission/userrolepermission/v4            true

10.) The per-permission component dependent apis are in "ready" status.

    cmd> kubectl get dependentapis -n components

    NAME                                  READY   AGE     SVCINVID                               URL
    par-party-party-role-management-api           50m
    per-permission-party-management-api   true    5m55s   19380cc0-a7c3-452b-a819-42a74ccb9fda   https://localhost/par-party/tmf-api/party/v4

11.) The reason why party component does not yet have its dependent api in the state READY=true, is that there is a circular dependency between TMFC028 and TMFC035.
    To resolve this cycle, you must restart the canvas-depapi-op deployment.

    cmd> kubectl rollout restart deployment canvas-depapi-op -n canvas

12.) After the restart, both components should reach the Complete status.

    cmd> kubectl get components -n components

    NAME             DEPLOYMENT_STATUS
    par-party        Complete
    per-permission   Complete    

13.) Now both dependent apis are in status READY=true

    cmd> kubectl get dependentapis -n components

    NAME                                  READY   AGE   SVCINVID                               URL
    par-party-party-role-management-api   true    66m   bd33150f-5c1b-490a-ae74-10dc71c16b72   https://localhost/per-permission/tmf-api/partyRoleManagement/v4
    per-permission-party-management-api   true    21m   19380cc0-a7c3-452b-a819-42a74ccb9fda   https://localhost/par-party/tmf-api/party/v4

14.) As a final optional step, you can use the ODA Canvas utility component-info to verify that both components have been successfully deployed.

    See this doc on how to install the "component-info" utility
    https://tmforum-oda.github.io/oda-ca-docs/canvas/source/utilities/README.html

    cmd> kubectl component-info

    Using Components Custom Resource Definition: v1


    Component: par-party
    Namespace: components
    Deployment Status: Complete
    └─ APIs
       └─ coreFunction
          └─ par-party-party-management-api
             ├─ url: https://localhost/par-party/tmf-api/party/v4
             ├─ ready: true
             └─ developerUI: https://localhost/par-party/tmf-api/party/v4/docs




    Component: per-permission
    Namespace: components
    Deployment Status: Complete
    └─ APIs
       └─ coreFunction
          ├─ per-permission-userrole-permission-management-api
          │  ├─ url: https://localhost/per-permission/userrolepermission/v4
          │  ├─ ready: true
          │  └─ developerUI: https://localhost/per-permission/userrolepermission/v4/docs
          └─ per-permission-party-role-management-api
             ├─ url: https://localhost/per-permission/tmf-api/partyRoleManagement/v4
             ├─ ready: true
             └─ developerUI: https://localhost/per-permission/tmf-api/partyRoleManagement/v4/docs






############# Second: run the CTK #############

1.) Navigate to the TMFC028 Party CTK tests

    cmd> cd <projectFolder>\TMFC028-PartyManagement\CTK\componentCTK

2.) Edit the CHANGE_ME.json file in the componentCTK directory. Set the "par" and "per" release names that were used in the
    instructions above when deploying the TMFC028 and TMFC035-stub components to the ODA canvas.

    /releaseName="par"
    /component_to_run="tmfc028
    /dependentStubs/tmfc028/partyRole/releaseName="per"

3.) Run the TMFC028 Party CTK test script:

    On Windows: WINDOWS-RUN.bat

    On macOS/Linux: run.sh or MAC-LINUX-RUN.sh



